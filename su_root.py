import subprocess
import re

GROUP_PATH = "/etc/group"
SU_PATH = "/etc/pam.d/su"

def check_wheel_group():
    try:
        with open(GROUP_PATH, 'r') as file:
            content = file.read()

        wheel_pattern = r'wheel.*'
        match = re.search(wheel_pattern, s)
        if match:
           
            part = match.group(0)
           
            chunks = part.split(':')
            return chunks[-1].split(",") 

        return ""
              
    except FileNotFoundError:
        print(f"    파일이 존재하지 않습니다: {PAM_SYSTEM_AUTH}")
    except Exception as e:
        print(f"    파일을 읽는 중 오류 발생: {e}")

def check_config(users):
    try:
        with open(SU_PATH, 'r') as file:
            content = file.read()
        auth_pattern = r'auth required /lib/security/pam_wheel.so .*'
        match = re.search(auth_pattern, s)
        if match:
            if match == "debug group=wheel":
                print("[양호] root 계정 su 제한이 설정되어 있습니다.")
            elif sorted(match.split(" ")) == sorted(users):
                print("[양호] root 계정 su 제한이 설정되어 있습니다.")
            else:
                print("[취약] root 계정 su 제한이 설정되어 있지 않습니다.")


        return ""
              
    except FileNotFoundError:
        print(f"    파일이 존재하지 않습니다: {PAM_SYSTEM_AUTH}")
    except Exception as e:
        print(f"    파일을 읽는 중 오류 발생: {e}")



def main(os_type):
    print("")
    print("======================= U-45 root 계정 su 제한 =========================")
    users = check_wheel_group()
    check_config(users)