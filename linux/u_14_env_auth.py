import utils.auth_checker
import subprocess

def check_env_auth():
    myaccount = subprocess.run("whoami", shell = True, capture_output = True, text = True).stdout
    
    file_list = ["~/.profile", "~/.kshrc", "~/.bashrc", "~/.bash_profile", "~/.login", "~/.exrc", "~/.netrc"]
    is_exploit = False
    for file in file_list:
        auth_checker_result = utils.auth_checker.main(file)
        if auth_checker_result:
            auth_line = auth_checker_result.split(" ")[0]
            auth_owner = auth_checker_result.split(" ")[2]

            if auth_owner not in [myaccount, "root"]:
                print(auth_owner)
                print(f"소유자 변경 필요 파일 : {file}")
                is_exploit = True
            elif "w" == auth_line[6] or "w" == auth_line[9]:
                print(f"일반 사용자 쓰기 권한 제거 필요 파일 : {file}")
                is_exploit = True
    return is_exploit

def main():
    print("")
    print("======================= U-14 사용자, 시스템 시작파일 및 환경파일 소유자 및 권한 설정 =========================")
    if check_env_auth() == False:
        print("[양호] 사용자, 시스템 시작파일 및 환경파일 소유자 및 권한 설정")
    else:
        print("[취약] 사용자, 시스템 시작파일 및 환경파일 소유자 및 권한 설정")