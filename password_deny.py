import re

# 파일 경로
PAM_SYSTEM_AUTH = '/etc/pam.d/common-auth'

def check_deny_value():
    try:
        with open(PAM_SYSTEM_AUTH, 'r') as file:
            content = file.read()

            # pam_faillock.so 모듈이 포함된 줄을 찾고 deny 값을 추출
            matches = re.findall(r'pam_faillock\.so.*deny=(\d+)', content)

            if matches:
                deny_values = [int(match) for match in matches]
                for deny_value in deny_values:
                    if deny_value <= 10:
                        print(f"[양호] 현재 임계값: {deny_value}")
                    else:
                        print(f"[취약] 현재 임계값: {deny_value}")
            else:
                print("[취약] pam_faillock.so 모듈에 deny 값이 설정되어 있지 않습니다.")
                
    except FileNotFoundError:
        print(f"    파일이 존재하지 않습니다: {PAM_SYSTEM_AUTH}")
    except Exception as e:
        print(f"    파일을 읽는 중 오류 발생: {e}")

def main():
    check_deny_value()