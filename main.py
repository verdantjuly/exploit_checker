import sys
import io
import script  # 사용자 정의 모듈

class DualWriter(io.StringIO):
    def __init__(self, file):
        super().__init__()
        self.file = file
        self.file_open = True

    def write(self, s):
        super().write(s)
        if self.file_open:
            self.file.write(s)
    
    def flush(self):
        super().flush()
        if self.file_open:
            self.file.flush()

    def close(self):
        self.file_open = False
        super().close()

def ask_user_for_logging():
   
    while True:
        response = input("콘솔 출력을 파일로 저장하시겠습니까? (y/n): ").strip().lower()
        if response in ('y', 'n'):
            return response == 'y'
        else:
            print("잘못된 입력입니다. 'y' 또는 'n'을 입력해주세요.")

def run_script(save_to_file):

    if save_to_file:
        with open('result.txt', 'w') as file:
            dual_writer = DualWriter(file)
            sys.stdout = dual_writer
            script.main()  # 사용자 정의 모듈의 main 함수 호출
            sys.stdout = sys.__stdout__  # 콘솔 출력을 원래대로 복원
            dual_writer.close()
    else:
        script.main()  # 콘솔에 직접 출력

if __name__ == "__main__":
    save_to_file = ask_user_for_logging()
    run_script(save_to_file)
