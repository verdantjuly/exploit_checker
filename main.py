import sys
import io
import script

class DualWriter(io.StringIO):
    def __init__(self, file):
        super().__init__()
        self.file = file
        self.file_open = True

    def write(self, s):
        super().write(s)
        if self.file_open:
            self.file.write(s)

    def close(self):
        self.file_open = False
        super().close()

def ask_user_for_logging():
    """콘솔 출력을 파일로 저장할지 여부를 묻는 함수"""
    while True:
        response = input("콘솔 출력을 파일로 저장하시겠습니까? (y/n): ").strip().lower()
        if response in ('y', 'n'):
            return response == 'y'
        else:
            print("잘못된 입력입니다. 'y' 또는 'n'을 입력해주세요.")

def run_script(save_to_file):
    """스크립트를 실행하고, 콘솔 출력을 파일로 저장하거나 직접 출력"""
    if save_to_file:
        with open('result.txt', 'w') as file:
            dual_writer = DualWriter(file)
            sys.stdout = dual_writer
            
            try:
                script.main()  
            finally:
                sys.stdout = sys.__stdout__ 
                dual_writer.close()  

        print("최상위 경로에 result.txt가 저장되었습니다.")
        
        
        with open('result.txt', 'r') as file:
            print("\n파일 내용:")
            print(file.read())

    else:
        try:
            script.main()  
        except Exception as e:
            print(f"스크립트 실행 중 오류 발생: {e}")

if __name__ == "__main__":
    save_to_file = ask_user_for_logging()
    run_script(save_to_file)
